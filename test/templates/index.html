<!DOCTYPE html>
<html>
<head>
    <title>Smart Detector</title>
    <meta http-equiv="refresh" content="35">
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; background: #f0f0f0; }
        .box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .optimal { border-left: 10px solid green; }
        .bad { border-left: 10px solid red; }
    </style>
</head>
<body>
    <h1>Mon Espace de Travail</h1>
    
    <div class="box {{ 'optimal' if last and last.is_optimal else 'bad' }}">
        <h2>Dernière mesure : {{ '✅ OK' if last and last.is_optimal else '⚠️ Alerte' }}</h2>
        <p>Temp: {{ last.temperature if last else '--' }}°C | Lum: {{ last.luminosity if last else '--' }} | Son: {{ last.sound_level if last else '--' }}</p>
    </div>

    <div class="box">
        <h3>Calibration & Préférences</h3>
        <button onclick="getLive()">Capturer les valeurs en direct</button>
        <p id="live-text"></p>
        
        <form action="/update_prefs" method="post">
            <h4>Seuils Temp (°C)</h4>
            Min: <input type="number" step="0.1" name="min_t" id="in_t" value="{{ prefs.min_temp }}"> 
            Max: <input type="number" step="0.1" name="max_t" value="{{ prefs.max_temp }}">
            <h4>Seuils Lumière</h4>
            Min: <input type="number" name="min_l" id="in_l" value="{{ prefs.min_lumi }}"> 
            Max: <input type="number" name="max_l" value="{{ prefs.max_lumi }}">
            <h4>Seuils Son</h4>
            Min: <input type="number" name="min_s" id="in_s" value="{{ prefs.min_sound }}"> 
            Max: <input type="number" name="max_s" value="{{ prefs.max_sound }}">
            <br><br><button type="submit">Enregistrer</button>
        </form>
    </div>

    <script>
        async function getLive() {
            const res = await fetch('/api/calibrate');
            const data = await res.json();
            document.getElementById('live-text').innerText = `Direct -> Temp: ${data.t}, Lum: ${data.l}, Son: ${data.s}`;
            if(confirm("Utiliser comme valeurs minimales ?")) {
                document.getElementById('in_t').value = data.t;
                document.getElementById('in_l').value = data.l;
                document.getElementById('in_s').value = data.s;
            }
        }
    </script>
</body>
</html>